{% extends 'base.html' %}

{% load i18n %}

{% load static %}

{% load lao_filters %}

{% block title %}{{ room.room_type.name }} - Room {{ room.id }} - Hotel{% endblock %}

{% block extra_css %}
<style>
    .room-gallery {
        position: relative;
    }
    
    .amenity-icon {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 0.75rem;
    }
    
    .room-feature-card:hover {
        transform: translateY(-2px);
        transition: all 0.3s ease;
    }
    
    .booking-card {
        position: sticky;
        top: 100px;
    }
    
    .price-breakdown {
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    }
    
    .gallery-thumbnail {
        transition: all 0.3s ease;
    }

    .gallery-thumbnail:hover {
        transform: scale(1.05);
    }

    .gallery-thumbnail.active {
        border: 3px solid #dabc94;
    }

    /* Taobao-style vertical gallery styles */
    .vertical-thumbnail {
        transition: all 0.2s ease;
        border: 2px solid transparent;
    }

    .vertical-thumbnail:hover {
        transform: scale(1.05);
        border-color: #dabc94;
    }

    .vertical-thumbnail.active {
        border-color: #dabc94 !important;
        box-shadow: 0 4px 12px rgba(218, 188, 148, 0.3);
    }

    /* Smooth scrolling for thumbnail container */
    .thumbnail-container {
        transition: transform 0.3s ease-out;
    }

    /* Hide scrollbars */
    .thumbnail-scroll::-webkit-scrollbar {
        display: none;
    }

    .thumbnail-scroll {
        -ms-overflow-style: none;
        scrollbar-width: none;
    }
    

    .room-feature-card {
        transition: all 0.3s ease;
        cursor: pointer;
    }
    
    .room-feature-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }
    
    .amenity-icon {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 0.75rem;
        transition: all 0.3s ease;
    }
    
    .room-feature-card:hover .amenity-icon {
        transform: scale(1.1);
    }
</style>

{% endblock %}

{% block content %}
<div class="dark:bg-neutral-dark min-h-screen">
    
    <!-- Breadcrumb -->
    <nav class=" shadow-sm">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-4">
            <ol class="flex items-center space-x-2 text-sm">
                <li><a href="{% url 'home-page' %}" class= hover:text-secondary-light">{% trans "Home" %}</a></li>
                <li class="text-gray-400">/</li>
                <li><a href="{% url 'rooms-list-page' %}" class= hover:text-secondary-light">{% trans "All Rooms" %}</a></li>
                <li class="text-gray-400">/</li>
                <li class="text-gray-600 dark:text-gray-300">{{ room.room_type.name }}</li>
            </ol>
        </div>
    </nav>

    <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div class="text-center mb-8">
            <p class="text-lg text-gray-700 dark:text-gray-300 leading-relaxed">
                {% trans "Welcome to Pilgrim’s Kitchen & Inn, where food, coffee, and comfort meet on the great Mekong River. With magnificent views of Thailand, our place is not just a coffee shop — it is a riverside retreat designed for travelers, locals, and coffee lovers." %}
            </p>
        </div>
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <!-- Main Content -->
            <div class="lg:col-span-2 space-y-8">
                <!-- Room Gallery - Taobao Style -->
                <div class="rounded-xl shadow-lg overflow-hidden" x-data="imageGallery()" x-init="init()">
                    <div class="flex">
                        <!-- Vertical Thumbnail Gallery (Left Side) - Taobao Style -->
                        {% if room_images.count > 1 or room.image and room_images.count > 0 %}
                        <div class="w-24 flex flex-col border-r border-gray-200 dark:border-gray-700">
                            <!-- Thumbnail Container -->
                            <div class="flex-1 overflow-hidden relative p-2" id="thumbnail-container">
                                <div class="transition-transform duration-300 ease-out"
                                     :style="`transform: translateY(-${scrollOffset * 68}px)`">

                                    <!-- Room Images from RoomImage model -->
                                    {% for image in room_images %}
                                    <div class="p-1">
                                        <div class="w-16 h-16 cursor-pointer rounded-lg overflow-hidden transition-all duration-200"
                                             :class="{ 'border-2 border-amber-500 shadow-md ring-2 ring-amber-200': activeImage === '{{ image.image.url }}' }"
                                             @click="setActiveImage('{{ image.image.url }}', {{ forloop.counter0 }})"
                                             @mouseenter="setActiveImage('{{ image.image.url }}', {{ forloop.counter0 }})">
                                            <img src="{{ image.image.url }}"
                                                 alt="{{ image.alt_text|default:'Room view'|add:' '|add:forloop.counter }}"
                                                 class="w-full h-full object-cover hover:scale-105 transition-transform duration-200">
                                            {% if image.is_primary %}
                                            <div class="absolute top-1 right-1 bg-amber-500 text-white text-xs px-1 rounded">
                                                <i class="fas fa-star"></i>
                                            </div>
                                            {% endif %}
                                        </div>
                                    </div>
                                    {% endfor %}

                                    <!-- Fallback to single room.image if no RoomImages exist -->
                                    {% if not room_images.exists and room.image %}
                                    <div class="p-1">
                                        <div class="w-16 h-16 cursor-pointer rounded-lg overflow-hidden transition-all duration-200"
                                             :class="{ 'border-2 border-amber-500 shadow-md ring-2 ring-amber-200': activeImage === '{{ room.image.url }}' }"
                                             @click="setActiveImage('{{ room.image.url }}', 0)"
                                             @mouseenter="setActiveImage('{{ room.image.url }}', 0)">
                                            <img src="{{ room.image.url }}"
                                                 alt="Room view"
                                                 class="w-full h-full object-cover hover:scale-105 transition-transform duration-200">
                                        </div>
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        {% endif %}

                        <!-- Main Image Container -->
                        <div class="flex-1 relative rounded-2xl overflow-hidden">
                            <div class="relative h-96 md:h-[500px] lg:h-[600px] overflow-hidden rounded-2xl">
                                {% if primary_image %}
                                <img :src="activeImage || '{{ primary_image.image.url }}'"
                                     alt="{{ primary_image.alt_text|default:room.room_type.name }}"
                                     class="w-full h-full object-cover transition-opacity duration-300">
                                {% elif room.image %}
                                <img :src="activeImage || '{{ room.image.url }}'"
                                     alt="{{ room.room_type.name }}"
                                     class="w-full h-full object-cover transition-opacity duration-300">
                                {% else %}
                                <div class="w-full h-full from-gray-200 to-gray-300 dark:from-gray-700 dark:to-gray-800 flex items-center justify-center">
                                    <div class="text-center">
                                        <i class="fas fa-bed text-6xl text-gray-400 dark:text-gray-500 mb-4"></i>
                                        <p class="text-gray-500 dark:text-gray-400">{% trans "Room Image Coming Soon" %}</p>
                                    </div>
                                </div>
                                {% endif %}

                                <!-- Image Navigation Arrows -->
                                {% if room_images.count > 1 or room.image and room_images.count > 0 %}
                                <div class="absolute inset-0 flex items-center justify-between p-4 opacity-0 hover:opacity-100 transition-opacity duration-300">
                                    <button @click="previousImage()"
                                            class="bg-black/50 hover:bg-black/70 text-white p-3 rounded-full transition-all duration-200 transform hover:scale-110">
                                        <i class="fas fa-chevron-left"></i>
                                    </button>
                                    <button @click="nextImage()"
                                            class="bg-black/50 hover:bg-black/70 text-white p-3 rounded-full transition-all duration-200 transform hover:scale-110">
                                        <i class="fas fa-chevron-right"></i>
                                    </button>
                                </div>
                                {% endif %}

                                <!-- Image Counter -->
                                {% if room_images.count > 1 or room.image and room_images.count > 0 %}
                                <div class="absolute bottom-4 right-4 bg-black/70 text-white px-3 py-2 rounded-full text-sm font-medium">
                                    <span x-text="currentImageIndex + 1">1</span> / <span x-text="totalImages">{{ room_images.count|default:1 }}</span>
                                </div>
                                {% endif %}

                                <!-- Image Info Badge -->
                                <div class="absolute top-4 left-4 bg-black/70 text-white px-3 py-2 rounded-lg text-sm font-medium">
                                    <i class="fas fa-camera mr-2"></i>{{ room.room_type.name }}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>


    
                <!-- Room Features & Amenities -->
                <div class=" rounded-xl shadow-lg p-6">
                    <h2 class="text-2xl font-playfair font-bold text-primary-light dark:text-white mb-6">{% trans "Room Features & Amenities" %}</h2>
                    
                    {% if room_amenities_data %}
                        <!-- Premium Amenities Section -->
                        {% if premium_amenities_data %}
                        <div class="mb-8">
                            <h3 class="text-lg font-semibold mb-4 flex items-center">
                                <i class="fas fa-crown mr-2"></i>
                                {% trans "Premium Features" %}
                            </h3>
                            <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
                                {% for amenity_data in premium_amenities_data %}
                                <div class="room-feature-card text-center p-4 rounded-lg from-{{ amenity_data.amenity.icon_color }}-50 to-{{ amenity_data.amenity.icon_color }}-100 dark:from-{{ amenity_data.amenity.icon_color }}-900 dark:to-{{ amenity_data.amenity.icon_color }}-800 border border-{{ amenity_data.amenity.icon_color }}-200 dark:border-{{ amenity_data.amenity.icon_color }}-700">
                                    <div class="amenity-icon bg-{{ amenity_data.amenity.icon_color }}-100 dark:bg-{{ amenity_data.amenity.icon_color }}-900 text-{{ amenity_data.amenity.icon_color }}-600 dark:text-{{ amenity_data.amenity.icon_color }}-300 relative">
                                        <i class="{{ amenity_data.amenity.icon }} text-xl"></i>
                                        <div class="absolute -top-1 -right-1 w-4 h-4 bg-yellow-400 rounded-full flex items-center justify-center">
                                            <i class="fas fa-star text-xs text-yellow-800"></i>
                                        </div>
                                    </div>
                                    <h4 class="font-semibold text-gray-800 dark:text-gray-200 mb-1">{{ amenity_data.amenity.name }}</h4>
                                    <p class="text-xs text-gray-600 dark:text-gray-400">
                                        {{ amenity_data.description }}
                                    </p>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                        {% endif %}
                        
                        <!-- Standard Amenities Section -->
                        {% if standard_amenities_data %}
                        <div>
                            {% if premium_amenities_data %}
                            <h3 class="text-lg font-semibold dark:text-gray-300 mb-4 flex items-center">
                                <i class="fas fa-check-circle mr-2"></i>
                                {% trans "Standard Features" %}
                            </h3>
                            {% endif %}
                            <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
                                {% for amenity_data in standard_amenities_data %}
                                <div class="room-feature-card text-center p-4 rounded-lg hover:bg-{{ amenity_data.amenity.icon_color }}-50 dark:hover:bg-{{ amenity_data.amenity.icon_color }}-900 transition-colors duration-300">
                                    <div class="amenity-icon bg-{{ amenity_data.amenity.icon_color }}-100 dark:bg-{{ amenity_data.amenity.icon_color }}-900 text-{{ amenity_data.amenity.icon_color }}-600 dark:text-{{ amenity_data.amenity.icon_color }}-300">
                                        <i class="{{ amenity_data.amenity.icon }} text-xl"></i>
                                    </div>
                                    <h4 class="font-semibold text-gray-800 dark:text-gray-200 mb-1">{{ amenity_data.amenity.name }}</h4>
                                    <p class="text-xs text-gray-600 dark:text-gray-400">
                                        {{ amenity_data.description }}
                                    </p>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                        {% endif %}
                        
                        <!-- Amenities Summary -->
                        <div class="mt-6 pt-6 border-t border-gray-200 dark:border-gray-700">
                            <div class="flex items-center justify-between text-sm text-gray-600 dark:text-gray-400">
                                <span>
                                    <i class="fas fa-list-check mr-1"></i>
                                    {% blocktrans count counter=room_amenities_data|length %}{{ counter }} total amenity{% plural %}{{ counter }} total amenities{% endblocktrans %}
                                </span>
                                {% if premium_amenities_data %}
                                <span class="bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200 px-2 py-1 rounded-full text-xs">
                                    <i class="fas fa-crown mr-1"></i>
                                    {% blocktrans count counter=premium_amenities_data|length %}{{ counter }} premium feature{% plural %}{{ counter }} premium features{% endblocktrans %}
                                </span>
                                {% endif %}
                            </div>
                        </div>
                        
                    {% else %}
                        <!-- Fallback for rooms without amenities -->
                        <div class="text-center py-8">
                            <i class="fas fa-info-circle text-4xl text-gray-400 dark:text-gray-500 mb-4"></i>
                            <p class="text-gray-600 dark:text-gray-400">{% trans "Amenity information will be updated soon." %}</p>
                        </div>
                    {% endif %}
                </div>


                

                <!-- Room Policies -->
                <!-- <div class=" rounded-xl shadow-lg p-6">
                    <h2 class="text-2xl font-playfair font-bold text-primary-light dark:text-white mb-6">Room Policies</h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-200 mb-3 flex items-center">
                                <i class="fas fa-clock mr-2"></i>
                                Check-in & Check-out
                            </h3>
                            <ul class="space-y-2 text-gray-600 dark:text-gray-300 text-sm">
                                <li class="flex items-center">
                                    <i class="fas fa-sign-in-alt text-green-500 mr-2"></i>
                                    Check-in: 3:00 PM onwards
                                </li>
                                <li class="flex items-center">
                                    <i class="fas fa-sign-out-alt text-red-500 mr-2"></i>
                                    Check-out: Until 11:00 AM
                                </li>
                                <li class="flex items-center">
                                    <i class="fas fa-id-card text-blue-500 mr-2"></i>
                                    Valid ID required
                                </li>
                            </ul>
                        </div>
                        
                        <div>
                            <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-200 mb-3 flex items-center">
                                <i class="fas fa-ban mr-2"></i>
                                Restrictions
                            </h3>
                            <ul class="space-y-2 text-gray-600 dark:text-gray-300 text-sm">
                                <li class="flex items-center">
                                    <i class="fas fa-smoking-ban text-red-500 mr-2"></i>
                                    Non-smoking room
                                </li>
                                <li class="flex items-center">
                                    <i class="fas fa-paw text-orange-500 mr-2"></i>
                                    Pets allowed (extra charge)
                                </li>
                                <li class="flex items-center">
                                    <i class="fas fa-volume-down text-blue-500 mr-2"></i>
                                    Quiet hours: 10 PM - 7 AM
                                </li>
                            </ul>
                        </div>
                    </div>
                </div> -->

                <!-- Related Hotels -->
                {% if related_hotels %}
                <div class=" rounded-xl shadow-lg p-6">
                    <h2 class="text-2xl font-playfair font-bold text-primary-light dark:text-white mb-6">{% trans "Related Properties" %}</h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        {% for hotel in related_hotels %}
                        <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4 hover:shadow-md transition-all">
                            <div class="flex items-start space-x-4">
                                {% if hotel.image %}
                                <img src="{{ hotel.image.url }}" 
                                     alt="{{ hotel.name }}" 
                                     class="w-20 h-20 object-cover rounded-lg">
                                {% else %}
                                <div class="w-20 h-20 bg-gray-200 dark:bg-gray-700 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-building text-gray-400"></i>
                                </div>
                                {% endif %}
                                
                                <div class="flex-1">
                                    <h3 class="font-semibold text-gray-800 dark:text-gray-200 mb-1">{{ hotel.name }}</h3>
                                    <p class="text-sm text-gray-600 dark:text-gray-400 mb-2">{{ hotel.description|truncatewords:10 }}</p>
                                    <a href="#" class= text-sm hover:underline">
                                        {% trans "View Details" %} <i class="fas fa-arrow-right ml-1"></i>
                                    </a>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}
            </div>

            <!-- Booking Sidebar -->
            <div class="lg:col-span-1">
                <div class="booking-card  rounded-xl shadow-lg p-6 space-y-6">
                    
                    <!-- Price Display -->
                    <div class="text-center border-b border-gray-200 dark:border-gray-700 pb-6">
                        <div class="text-3xl font-bold mb-2">
                            {{ room.room_type.price_per_night|lao_currency }}
                        </div>
                        <div class="text-gray-600 dark:text-gray-300 text-sm">{% trans "per night" %}</div>
                        <div class="text-xs text-gray-500 dark:text-gray-400 mt-1">{% trans "Taxes and fees included" %}</div>
                    </div>

                    <div class="text-center border-b border-gray-200 dark:border-gray-700 pb-6">
                        <div class="text-3xl font-bold mb-2">
                            {{ room.room_type.name }}
                        </div>
                        <div class="text-gray-600 dark:text-gray-300 text-sm"> <i class="fas fa-door-open mr-2"></i> {{ room.room_type.description }}</div>
                        <div class="text-xs text-gray-500 dark:text-gray-400 mt-1"> <i class="fas fa-users mr-2"></i> {% blocktrans %}Up to {{ room.room_type.capacity }} guests{% endblocktrans %}</div>
                    </div>

                    <div class="text-center border-b border-gray-200 dark:border-gray-700 pb-6">
                        <div class="text-3xl font-bold mb-2">
                            {% trans "Room Policies" %}
                        </div>
                        <div class="text-lg font-semibold text-gray-800 dark:text-gray-200"> <i class="fas fa-clock mr-2"></i>
                            {% trans "Check-in & Check-out" %}
                        </div>
                        <div class="text-xs text-gray-500 dark:text-gray-400 mt-1">  <i class="fas fa-sign-in-alt text-green-500 mr-2"></i>
                            {% trans "Check-in:" %} {{ room.check_in_date }} PM 
                        </div>
                        <div class="text-xs text-gray-500 dark:text-gray-400 mt-1"> <i class="fas fa-sign-out-alt text-red-500 mr-2"></i>
                            {% trans "Check-out:" %} {{ room.check_out_date }} AM
                        </div>
                        <div class="text-xs text-gray-500 dark:text-gray-400 mt-1"> <i class="fas fa-id-card text-blue-500 mr-2"></i>
                            {% trans "Valid ID required" %}
                        </div>

                        <div class="text-lg font-semibold text-gray-800 dark:text-gray-200"> <i class="fas fa-ban mr-2"></i>
                            {% trans "Restrictions" %}
                        </div>
                        <div class="text-xs text-gray-500 dark:text-gray-400 mt-1">   <i class="fas fa-smoking-ban text-red-500 mr-2"></i>
                            {% trans "Non-smoking room" %}
                        </div>
                    </div>



                    <!-- Booking Links -->
                    <div class="text-center border-b border-gray-200 dark:border-gray-700 pb-6">
                        <div class="text-xl font-bold mb-4">
                            {% trans "Need help with your booking?" %}
                        </div>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                            <div onclick="openReviewPlatform('agoda')">
                                <button class="w-full border-2 border-gray-300 hover:border-red-500 bg-transparent hover:text-red-600 py-3 px-4 rounded-lg transition duration-300 font-medium flex flex-col items-center justify-center">
                                    <img src="https://i.pinimg.com/736x/a2/b0/5d/a2b05d6d5547345a295614f8ebe90c56.jpg"
                                    class="w-8 h-8 mb-2 rounded-full object-cover"
                                    alt="Agoda Logo">
                                    <span class="text-xs">Agoda</span>
                                </button>
                            </div>

                            <div onclick="openReviewPlatform('booking')">
                                <button class="w-full border-2 border-gray-300 hover:border-blue-500 bg-transparent hover:text-blue-600 py-3 px-4 rounded-lg transition duration-300 font-medium flex flex-col items-center justify-center">
                                    <img src="https://i.pinimg.com/736x/2f/f7/ee/2ff7ee806d977d4884e2aadfa8fc1101.jpg"
                                    class="w-8 h-8 mb-2 rounded-full object-cover"
                                    alt="Booking.com Logo">
                                    <span class="text-xs">Booking</span>
                                </button>
                            </div>

                            <div onclick="openReviewPlatform('expedia')">
                                <button class="w-full border-2 border-gray-300 hover:border-yellow-500 bg-transparent hover:text-yellow-600 py-3 px-4 rounded-lg transition duration-300 font-medium flex flex-col items-center justify-center">
                                    <img src="https://i.pinimg.com/736x/08/7a/e9/087ae99de1c8af19b618307b1631314a.jpg"
                                    class="w-8 h-8 mb-2 rounded-full object-cover"
                                    alt="Expedia Logo">
                                    <span class="text-xs">Expedia</span>
                                </button>
                            </div>

                            <div onclick="openReviewPlatform('whatsapp')">
                                <button class="w-full border-2 border-gray-300 hover:border-green-500 bg-transparent hover:text-green-600 py-3 px-4 rounded-lg transition duration-300 font-medium flex flex-col items-center justify-center">
                                    <img src="https://i.pinimg.com/736x/c6/09/0d/c6090df18193e2616a6a32076883b70c.jpg"
                                    class="w-8 h-8 mb-2 rounded-full object-cover"
                                    alt="WhatsApp Logo">
                                    <span class="text-xs">WhatsApp</span>
                                </button>
                            </div>
                            
                        </div>
                        <div class="text-gray-600 dark:text-gray-300 text-sm mt-4">{% trans "For better rates and more information, please contact us directly through our WhatsApp." %}</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<!-- Updated JavaScript Section -->
<script>
    
    function openReviewPlatform(platform) {
        let url = '';
        
        switch(platform) {
            case 'agoda':
                // Replace with your actual Agoda property URL
                url = 'https://www.agoda.com/pilgrims-kitchen-inn/hotel/savannakhet-la.html?countryId=190&finalPriceView=1&isShowMobileAppPrice=false&cid=-999&numberOfBedrooms=&familyMode=false&adults=2&children=0&rooms=1&maxRooms=0&checkIn=2025-10-1&isCalendarCallout=false&childAges=&numberOfGuest=0&missingChildAges=false&travellerType=1&showReviewSubmissionEntry=false&currencyCode=USD&isFreeOccSearch=false&los=7&searchrequestid=29893042-03f3-4850-b681-a74e9636398a&ds=visHuLZYSC4GlIOO';
                break;
            case 'booking':
                // Replace with your actual Booking.com property URL
                url = 'https://www.booking.com/hotel/la/pilgrim-39-s-kitchen-amp-inn.html?aid=304142&label=gen173nr-1FCBkoggI46AdIM1gEaIEBiAEBmAExuAEHyAEM2AEB6AEB-AECiAIBqAIDuALH65LDBsACAdICJDhjNTU0OWM2LTM0YWMtNDBhNi04ZThkLWExODQwM2YxNGQwY9gCBeACAQ&sid=9b35241d3d42c34c66c1e205f6709641&checkin=2025-07-02&checkout=2025-08-04&dest_id=1668881&dest_type=hotel&dist=0&group_adults=2&group_children=0&hapos=1&hpos=1&no_rooms=1&req_adults=2&req_children=0&room1=A%2CA&sb_price_type=total&soh=1&sr_order=popularity&srepoch=1751430651&srpvid=a91a5d5546be220aa7c21290647e010a&type=total&ucfs=1&#no_availability_msg';
                break;
            case 'expedia':
                // Replace with your actual Expedia property URL
                url = 'https://www.expedia.com/Savannakhet-Hotels-Pilgrims-Kitchen-Inn.h14986614.Hotel-Information?chkin=2025-10-26&chkout=2025-10-27&flexibility=1_DAY&searchRange=2025-09-01_2025-09-30%2C2025-10-01_2025-10-31&x_pwa=1&rfrr=HSR&pwa_ts=1758512563425&referrerUrl=aHR0cHM6Ly93d3cuZXhwZWRpYS5jb20vSG90ZWwtU2VhcmNo&useRewards=false&rm1=a2&regionId=4203&destination=Savannakhet%2C+Savannakhet+Province%2C+Laos&destType=MARKET&latLong=16.572249%2C104.770552&sort=RECOMMENDED&top_dp=23&top_cur=USD&userIntent=&selectedRoomType=201489188&selectedRatePlan=207472150&searchId=3d7caf90-437a-47b3-b17a-a1160d8ce092';
                break;
            case 'whatsapp':
                // Dynamic WhatsApp message with room details
                const message = `ສະບາຍດີ Pilgrims Kitchen & Inn,

ຂ້ອຍຕ້ອງການຈອງຫ້ອງພັກດັ່ງລຸ່ມນີ້:

🏨 ຫ້ອງ: {{ room.room_type.name }}
🏷️ ລາຄາ: {{ room.room_type.price_per_night|lao_currency }} ຕໍ່ຄືນ
👥 ຈຳນວນແຂກ:  ຄົນ (ຕ້ອງລະບຸຈຳນວນຄົນເຂົ້າພັກ)
🔗 ລິ້ງ: ${window.location.href}

ກະລຸນາແຈ້ງລາຍລະອຽດການຈັດສົ່ງ ແລະ ການຊຳລະເງິນ

ຂອບໃຈ!`;

                url = `https://wa.me/8562022133733?text=${encodeURIComponent(message)}`;
                break;
        }
        
        if (url) {
            window.open(url, '_blank');
        }
    }
    
    // Add scroll animations
    document.addEventListener('DOMContentLoaded', function() {
        const observerOptions = {
            threshold: 0.1,
            rootMargin: '0px 0px -50px 0px'
        };
        
        const observer = new IntersectionObserver(function(entries) {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.style.opacity = '1';
                    entry.target.style.transform = 'translateY(0)';
                }
            });
        }, observerOptions);
        
        // Animate review cards on scroll
        document.querySelectorAll('.review-card').forEach(card => {
            card.style.opacity = '0';
            card.style.transform = 'translateY(30px)';
            card.style.transition = 'all 0.6s ease';
            observer.observe(card);
        });
    });
</script>
<script>
// Taobao-style Hotel Room Gallery with Alpine.js
function imageGallery() {
    const images = [
        {% for image in room_images %}
        '{{ image.image.url }}'{% if not forloop.last %},{% endif %}
        {% endfor %}
        {% if not room_images.exists and room.image %}
        '{{ room.image.url }}'
        {% endif %}
    ].filter(img => img); // Remove empty strings

    return {
        activeImage: images[0] || null,
        images: images,
        currentImageIndex: 0,
        totalImages: images.length,
        scrollOffset: 0,
        maxVisibleThumbnails: 5, // Number of visible thumbnails

        // Computed properties for scroll buttons
        get canScrollUp() {
            return this.scrollOffset > 0;
        },
        get canScrollDown() {
            return this.scrollOffset < Math.max(0, this.totalImages - this.maxVisibleThumbnails);
        },

        setActiveImage(imageUrl, index) {
            this.activeImage = imageUrl;
            this.currentImageIndex = index !== undefined ? index : this.images.indexOf(imageUrl);
            // Auto-scroll thumbnails to keep active image visible
            this.autoScrollToActive();
        },

        nextImage() {
            if (this.currentImageIndex < this.images.length - 1) {
                this.currentImageIndex++;
            } else {
                this.currentImageIndex = 0; // Loop back to first image
            }
            this.activeImage = this.images[this.currentImageIndex];
            this.autoScrollToActive();
        },

        previousImage() {
            if (this.currentImageIndex > 0) {
                this.currentImageIndex--;
            } else {
                this.currentImageIndex = this.images.length - 1; // Loop to last image
            }
            this.activeImage = this.images[this.currentImageIndex];
            this.autoScrollToActive();
        },

        scrollUp() {
            if (this.canScrollUp) {
                this.scrollOffset--;
            }
        },

        scrollDown() {
            if (this.canScrollDown) {
                this.scrollOffset++;
            }
        },

        autoScrollToActive() {
            // Auto-scroll to keep the active thumbnail visible
            const activeIndex = this.currentImageIndex;
            const containerStart = this.scrollOffset;
            const containerEnd = this.scrollOffset + this.maxVisibleThumbnails - 1;

            if (activeIndex < containerStart) {
                // Scroll up to show the active thumbnail
                this.scrollOffset = activeIndex;
            } else if (activeIndex > containerEnd) {
                // Scroll down to show the active thumbnail
                this.scrollOffset = activeIndex - this.maxVisibleThumbnails + 1;
            }
        },

        // Smooth wheel scrolling for thumbnails
        handleWheel(event) {
            event.preventDefault();
            if (event.deltaY > 0) {
                this.scrollDown();
            } else {
                this.scrollUp();
            }
        },

        // Initialize on component mount
        init() {
            console.log('Taobao-style hotel gallery initialized with', this.totalImages, 'images');

            // Add wheel event listener to thumbnail container
            this.$nextTick(() => {
                const container = document.getElementById('thumbnail-container');
                if (container) {
                    container.parentElement.addEventListener('wheel', (e) => this.handleWheel(e));
                }
            });
        }
    };
}

// Legacy support for keyboard navigation
document.addEventListener('keydown', function(e) {
    if (e.key === 'ArrowLeft' && window.Alpine) {
        const gallery = document.querySelector('[x-data*="imageGallery"]').__x.$data;
        if (gallery && gallery.previousImage) {
            gallery.previousImage();
        }
    } else if (e.key === 'ArrowRight' && window.Alpine) {
        const gallery = document.querySelector('[x-data*="imageGallery"]').__x.$data;
        if (gallery && gallery.nextImage) {
            gallery.nextImage();
        }
    }
});
</script>
<script>
    // Gallery functions already defined in previous script block
    
    // Date validation
    document.addEventListener('DOMContentLoaded', function() {
        const checkInInput = document.querySelector('input[name="check_in"]');
        const checkOutInput = document.querySelector('input[name="check_out"]');
        
        // Set minimum date to today
        const today = new Date().toISOString().split('T')[0];
        checkInInput.min = today;
        checkOutInput.min = today;
        
        // Update check-out minimum when check-in changes
        checkInInput.addEventListener('change', function() {
            const checkInDate = new Date(this.value);
            checkInDate.setDate(checkInDate.getDate() + 1);
            checkOutInput.min = checkInDate.toISOString().split('T')[0];
            
            // Clear check-out if it's before new minimum
            if (checkOutInput.value && new Date(checkOutInput.value) <= new Date(this.value)) {
                checkOutInput.value = '';
            }
        });
    });
</script>
{% endblock %}