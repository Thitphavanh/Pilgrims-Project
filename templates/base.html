{% load static %}
{% load i18n %}

<!DOCTYPE html>

<html lang="{{ LANGUAGE_CODE }}" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="csrf-token" content="{{ csrf_token }}">
    <title>{% block title %}Pilgrims Hotel & Restaurant{% endblock %}</title>

    <!-- TailwindCSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        'primary': {
                            light: '#1E3A8A', // Deep blue for brand (light mode)
                            dark: '#3B82F6',  // Bright blue for brand (dark mode)
                            DEFAULT: '#1E3A8A'
                        },
                        'primary-dark': {
                            light: '#1E293B', // Darker shade for hover (light mode)
                            dark: '#0F172A',  // Darker shade for hover (dark mode)
                            DEFAULT: '#1E293B'
                        },
                        'secondary': {
                            light: '#FBBF24', // Warm gold for accents (light mode)
                            dark: '#F59E0B',  // Amber for accents (dark mode)
                            DEFAULT: '#FBBF24'
                        },
                        'secondary-dark': {
                            light: '#D97706', // Darker gold (light mode)
                            dark: '#B45309',  // Darker amber (dark mode)
                            DEFAULT: '#D97706'
                        },
                        'neutral': {
                            light: '#F3F4F6', // Light gray for backgrounds (light mode)
                            dark: '#1F2937',  // Dark gray for backgrounds (dark mode)
                            DEFAULT: '#F3F4F6'
                        },
                        'neutral-content': {
                            light: '#1F2937', // Content color for light mode
                            dark: '#F9FAFB',  // Content color for dark mode
                            DEFAULT: '#1F2937'
                        }
                    },
                    fontFamily: {
                        'inter': ['Inter', 'sans-serif'],
                        'playfair': ['Playfair Display', 'serif'],
                    },
                }
            }
        }
    </script>

    <!-- Custom styles for dark mode -->
    <style type="text/tailwind">
        @layer utilities {
            .dark .dark-shadow-lg {
                box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.4), 0 4px 6px -4px rgba(0, 0, 0, 0.4);
            }
            .dark .dark-shadow-md {
                box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -2px rgba(0, 0, 0, 0.3);
            }
            .animate-fade-in {
                animation: fadeIn 0.3s ease-in;
            }
            @keyframes fadeIn {
                from { opacity: 0; }
                to { opacity: 1; }
            }
            /* Custom classes for mobile menu to ensure JS control */
            .mobile-menu-open {
                display: block !important;
            }
            .mobile-menu-closed {
                display: none !important;
            }
        }
    </style>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:ital,wght@0,400;0,600;0,700;1,400&display=swap" rel="stylesheet">

    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    {% block extra_css %}{% endblock %}
</head>
<body class="bg-neutral-light dark:bg-neutral-dark font-inter flex flex-col min-h-screen antialiased text-neutral-content-light dark:text-neutral-content-dark transition-colors duration-300">
    <!-- Header & Navigation -->
    <header class="bg-white dark:bg-primary-dark-dark shadow-md dark:dark-shadow-md sticky top-0 z-50 transition-colors duration-300">
        <nav class="container mx-auto px-4 sm:px-6 lg:px-8 py-4 relative">
            <div class="flex items-center justify-between">
                <!-- Logo -->
                <div class="flex items-center">
                    <a href="{% url 'home-page' %}" class="font-playfair text-2xl sm:text-3xl font-bold text-primary-light dark:text-secondary-dark hover:text-secondary-light dark:hover:text-secondary-light transition duration-300 ease-in-out">
                        <img
                            src="{% static 'images/logo.jpeg' %}"
                            class="w-12 h-12 object-cover"
                            loading="lazy"
                        >
                    </a>
                </div>

                <!-- Desktop Navigation Links -->
                <div class="hidden md:flex md:items-center">
                    <ul class="flex flex-row space-x-6 lg:space-x-10 text-base sm:text-lg font-medium">
                        <li><a href="{% url 'about-page' %}" class="text-primary-light dark:text-neutral-content-dark hover:text-secondary-light dark:hover:text-secondary-light transition duration-300 border-b-2 border-transparent hover:border-secondary-light">{% trans "About Us" %}</a></li>
                        <li><a href="{% url 'rooms-list-page' %}" class="text-primary-light dark:text-neutral-content-dark hover:text-secondary-light dark:hover:text-secondary-light transition duration-300 border-b-2 border-transparent hover:border-secondary-light">{% trans "Reservation" %}</a></li>
                        <li><a href="{% url 'menu-page' %}" class="text-primary-light dark:text-neutral-content-dark hover:text-secondary-light dark:hover:text-secondary-light transition duration-300 border-b-2 border-transparent hover:border-secondary-light">{% trans "Menu" %}</a></li>
                        <li><a href="{% url 'coffee_list' %}" class="text-primary-light dark:text-neutral-content-dark hover:text-secondary-light dark:hover:text-secondary-light transition duration-300 border-b-2 border-transparent hover:border-secondary-light">{% trans "Coffee" %}</a></li>
                        <li><a href="{% url 'review-page' %}" class="text-primary-light dark:text-neutral-content-dark hover:text-secondary-light dark:hover:text-secondary-light transition duration-300 border-b-2 border-transparent hover:border-secondary-light">{% trans "Review" %}</a></li>
                        <li><a href="{% url 'contact-page' %}" class="text-primary-light dark:text-neutral-content-dark hover:text-secondary-light dark:hover:text-secondary-light transition duration-300 border-b-2 border-transparent hover:border-secondary-light">{% trans "Contact" %}</a></li>
                    </ul>
                </div>

                <!-- Right side buttons (Language, Theme, Mobile Menu) -->
                <div class="flex items-center space-x-2 sm:space-x-4">
                <!-- Language Toggle -->
                <!-- Language Toggle (Fixed Version) -->
                <div class="relative">
                    <button id="language-toggle" class="flex items-center p-2 rounded-full text-neutral-content-light dark:text-neutral-content-dark hover:bg-gray-100 dark:hover:bg-primary-dark focus:outline-none transition-colors duration-300" aria-label="Change language">
                        <i class="fas fa-globe text-lg sm:text-xl mr-1"></i>
                        <span class="text-sm font-medium">{{ LANGUAGE_CODE|upper }}</span>
                        <i class="fas fa-chevron-down text-xs ml-1 transition-transform duration-200" id="chevron-icon"></i>
                    </button>

                    <!-- Language Dropdown -->
                    <div id="language-dropdown" class="hidden absolute right-0 mt-2 w-48 bg-white dark:bg-primary-dark-dark rounded-lg shadow-lg dark:dark-shadow-lg border border-gray-200 dark:border-gray-600 z-50 opacity-0 transform scale-95 transition-all duration-200">
                        <div class="py-1">
                            <a href="javascript:void(0)" onclick="switchLanguage('lo')" class="block w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-primary-dark transition-colors duration-200">
                                <div class="flex items-center">
                                    <img src="https://flagcdn.com/w20/la.png" alt="ລາວ" class="w-5 h-3 mr-3 rounded">
                                    <span>ລາວ (Lao)</span>
                                    {% if LANGUAGE_CODE == 'lo' %}
                                        <i class="fas fa-check ml-auto text-secondary-light"></i>
                                    {% endif %}
                                </div>
                            </a>
                            <a href="javascript:void(0)" onclick="switchLanguage('en')" class="block w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-primary-dark transition-colors duration-200">
                                <div class="flex items-center">
                                    <img src="https://flagcdn.com/w20/us.png" alt="English" class="w-5 h-3 mr-3 rounded">
                                    <span>English</span>
                                    {% if LANGUAGE_CODE == 'en' %}
                                        <i class="fas fa-check ml-auto text-secondary-light"></i>
                                    {% endif %}
                                </div>
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Hidden CSRF form for language switching -->
                <form id="csrf-form" style="display: none;">
                    {% csrf_token %}
                </form>

                <!-- Dark Mode Toggle -->
                <button id="theme-toggle" class="p-2 rounded-full text-neutral-content-light dark:text-neutral-content-dark hover:bg-gray-100 dark:hover:bg-primary-dark focus:outline-none transition-colors duration-300">
                    <svg id="theme-toggle-light-icon" class="hidden dark:block w-5 h-5 sm:w-6 sm:h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                        <path d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" fill-rule="evenodd" clip-rule="evenodd"></path>
                    </svg>
                    <svg id="theme-toggle-dark-icon" class="block dark:hidden w-5 h-5 sm:w-6 sm:h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                        <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path>
                    </svg>
                </button>

                <!-- Mobile menu button -->
                <button id="mobile-menu-button" class="md:hidden text-primary-light dark:text-neutral-content-dark hover:text-secondary-light dark:hover:text-secondary-light focus:outline-none" aria-label="Toggle navigation">
                    <i class="fas fa-bars text-xl sm:text-2xl"></i>
                </button>
            </div>
            </div>

            <!-- Mobile Navigation Menu -->
            <div id="nav-content" class="hidden mobile-menu-closed absolute top-full left-0 right-0 w-full bg-white dark:bg-primary-dark-dark shadow-lg border-t border-gray-200 dark:border-gray-600 z-50">
                <div class="container mx-auto px-4">
                    <ul class="flex flex-col py-4 space-y-2">
                        <li><a href="{% url 'about-page' %}" class="block py-3 px-4 text-primary-light dark:text-neutral-content-dark hover:text-secondary-light dark:hover:text-secondary-light hover:bg-gray-50 dark:hover:bg-primary-dark rounded transition duration-300">{% trans "About Us" %}</a></li>
                        <li><a href="{% url 'rooms-list-page' %}" class="block py-3 px-4 text-primary-light dark:text-neutral-content-dark hover:text-secondary-light dark:hover:text-secondary-light hover:bg-gray-50 dark:hover:bg-primary-dark rounded transition duration-300">{% trans "Reservation" %}</a></li>
                        <li><a href="{% url 'menu-page' %}" class="block py-3 px-4 text-primary-light dark:text-neutral-content-dark hover:text-secondary-light dark:hover:text-secondary-light hover:bg-gray-50 dark:hover:bg-primary-dark rounded transition duration-300">{% trans "Menu" %}</a></li>
                        <li><a href="{% url 'coffee_list' %}" class="block py-3 px-4 text-primary-light dark:text-neutral-content-dark hover:text-secondary-light dark:hover:text-secondary-light hover:bg-gray-50 dark:hover:bg-primary-dark rounded transition duration-300">{% trans "Coffee" %}</a></li>
                        <li><a href="{% url 'review-page' %}" class="block py-3 px-4 text-primary-light dark:text-neutral-content-dark hover:text-secondary-light dark:hover:text-secondary-light hover:bg-gray-50 dark:hover:bg-primary-dark rounded transition duration-300">{% trans "Review" %}</a></li>
                        <li><a href="{% url 'contact-page' %}" class="block py-3 px-4 text-primary-light dark:text-neutral-content-dark hover:text-secondary-light dark:hover:text-secondary-light hover:bg-gray-50 dark:hover:bg-primary-dark rounded transition duration-300">{% trans "Contact" %}</a></li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>

    <!-- Messages/Alerts -->
    {% if messages %}
    <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-4">
        {% for message in messages %}
        <div class="{% if message.tags == 'success' %}bg-green-50 dark:bg-green-900 border-green-500 text-green-700 dark:text-green-200{% elif message.tags == 'error' %}bg-red-50 dark:bg-red-900 border-red-500 text-red-700 dark:text-red-200{% else %}bg-blue-50 dark:bg-blue-900 border-blue-500 text-blue-700 dark:text-blue-200{% endif %} px-4 sm:px-6 py-4 rounded-lg border-l-4 mb-4 shadow-md dark:dark-shadow-md relative transform transition-all duration-300 hover:shadow-lg">
            <div class="flex items-center">
                <div class="mr-3 sm:mr-4">
                    {% if message.tags == 'success' %}
                    <i class="fas fa-check-circle text-green-500 dark:text-green-300 text-lg sm:text-xl"></i>
                    {% elif message.tags == 'error' %}
                    <i class="fas fa-exclamation-circle text-red-500 dark:text-red-300 text-lg sm:text-xl"></i>
                    {% else %}
                    <i class="fas fa-info-circle text-blue-500 dark:text-blue-300 text-lg sm:text-xl"></i>
                    {% endif %}
                </div>
                <span class="block text-sm sm:text-base">{{ message }}</span>
            </div>
            <button type="button" class="absolute top-0 bottom-0 right-0 px-3 sm:px-4 py-3 alert-close focus:outline-none">
                <i class="fas fa-times text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 text-base sm:text-lg"></i>
            </button>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <!-- Main Content -->
    <main class="flex-grow">
        {% block content %}

        {% endblock %}
    </main>

    <!-- Footer -->
    <footer class="bg-primary-dark-light dark:bg-primary-dark-dark text-white py-12 sm:py-16 transition-colors duration-300">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8 sm:gap-12">
                <!-- Contact Info -->
                <div>
                    <h3 class="text-xl sm:text-2xl font-playfair mb-4 sm:mb-6 font-bold text-secondary-light dark:text-secondary-dark">{% trans "Contact Us" %}</h3>
                    <ul class="text-gray-200 space-y-3 sm:space-y-4 text-sm sm:text-base">
                        <li class="flex items-start">
                            <i class="fas fa-map-marker-alt mt-1 mr-3 sm:mr-4 text-secondary-light dark:text-secondary-dark flex-shrink-0"></i>
                            <div class="leading-relaxed">
                                <span class="block">{% trans "Khanthabouly Road, House No. 168" %}</span>
                                <span class="block">{% trans "Ban Chomkeo, Kaisone Phomvihane District" %}</span>
                                <span class="block">{% trans "Savannakhet, Lao PDR" %}</span>
                            </div>
                        </li>
                        <li class="flex items-center">
                            <i class="fas fa-phone-alt mr-3 sm:mr-4 text-secondary-light dark:text-secondary-dark flex-shrink-0"></i>
                            <div>
                                <span class="block">{% trans "Tel" %}:
                                    <a href="tel:+8562022133733"
                                    class="hover:text-secondary-light dark:hover:text-secondary-dark transition-colors duration-300 underline">
                                        +856 20 22133733
                                    </a>
                                </span>
                            </div>
                        </li>
                        <li class="flex items-center">
                            <i class="fas fa-envelope mr-3 sm:mr-4 text-secondary-light dark:text-secondary-dark flex-shrink-0"></i>
                            <div>
                                <span class="block">{% trans "Email" %}:
                                    <a href="mailto:pilgrimscontact@gmail.com"
                                    class="hover:text-secondary-light dark:hover:text-secondary-dark transition-colors duration-300 underline break-all">
                                        pilgrimscontact@gmail.com
                                    </a>
                                </span>
                            </div>
                        </li>

                    </ul>
                </div>

                <!-- Quick Links -->
                <div>
                    <h3 class="text-xl sm:text-2xl font-playfair mb-4 sm:mb-6 font-bold text-secondary-light dark:text-secondary-dark">{% trans "Stay Connected" %}</h3>
                    <ul class="text-gray-200 space-y-2 sm:space-y-3 text-sm sm:text-base">
                        <li>
                            <a href="#" class="hover:text-secondary-light dark:hover:text-secondary-dark transition duration-300 inline-block py-1 hover:translate-x-2 transform">
                                <i class="fas fa-share-alt mr-2"></i>
                                {% trans "Follow us on social media channels" %}
                            </a>
                        </li>
                        <li>
                            <a href="https://www.facebook.com/pilgrimskitchenandinn/"
                            target="_blank"
                            rel="noopener noreferrer"
                            class="hover:text-secondary-light dark:hover:text-secondary-dark transition duration-300 inline-flex items-center py-1 hover:translate-x-2 transform group">
                                <i class="fab fa-facebook-f mr-3 text-blue-500 group-hover:text-blue-400 transition-colors duration-300"></i>
                                Facebook
                            </a>
                        </li>
                        <li>
                            <a href="https://www.instagram.com/pilgrimskitchenandinn/"
                            target="_blank"
                            rel="noopener noreferrer"
                            class="hover:text-secondary-light dark:hover:text-secondary-dark transition duration-300 inline-flex items-center py-1 hover:translate-x-2 transform group">
                                <i class="fab fa-instagram mr-3 text-pink-500 group-hover:text-pink-400 transition-colors duration-300 bg-gradient-to-br from-purple-500 to-pink-500 bg-clip-text text-transparent"></i>
                                Instagram
                            </a>
                        </li>

                    </ul>
                </div>
                  <!-- Timings -->
                <div>
                    <h3 class="text-xl sm:text-2xl font-playfair mb-4 sm:mb-6 font-bold text-secondary-light dark:text-secondary-dark">{% trans "Timings" %}</h3>
                    <ul class="text-gray-200 space-y-3 sm:space-y-4 text-sm sm:text-base">
                        <li class="flex items-center">
                            <i class="fas fa-clock mr-3 sm:mr-4 text-secondary-light dark:text-secondary-dark flex-shrink-0"></i>
                            <div>
                                <span class="block font-medium">{% trans "Monday – Saturday" %}:</span>
                                <span class="block text-gray-300 dark:text-gray-400">7:30 AM – 9:00 PM</span>
                            </div>
                        </li>
                        <li class="flex items-center">
                            <i class="fas fa-times-circle mr-3 sm:mr-4 text-red-400 dark:text-red-500 flex-shrink-0"></i>
                            <div>
                                <span class="block font-medium">{% trans "Sunday" %}:</span>
                                <span class="block text-red-300 dark:text-red-400">{% trans "Closed" %}</span>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- Copyright -->
            <div class="border-t border-gray-600 mt-8 sm:mt-12 pt-6 sm:pt-8 text-center text-gray-400 text-sm">
                <p>© {% now "Y" %} Pilgrims Kitchen & Inn. {% trans "All rights reserved" %}.</p>
                <div class="mt-3 flex flex-wrap justify-center space-x-4 sm:space-x-6">
                    <a href="#" class="text-gray-400 hover:text-secondary-light dark:hover:text-secondary-dark transition duration-300">{% trans "Privacy" %}</a>
                    <a href="#" class="text-gray-400 hover:text-secondary-light dark:hover:text-secondary-dark transition duration-300">{% trans "Terms" %}</a>
                    <a href="#" class="text-gray-400 hover:text-secondary-light dark:hover:text-secondary-dark transition duration-300">{% trans "Sitemap" %}</a>
                </div>
            </div>
        </div>
    </footer>

    <!-- JavaScript -->
    <script src="{% static 'js/main.js' %}"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Theme toggle
            const themeToggleBtn = document.getElementById('theme-toggle');
            if (themeToggleBtn) {
                if (localStorage.getItem('color-theme') === 'dark' ||
                    (!('color-theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                    document.documentElement.classList.add('dark');
                } else {
                    document.documentElement.classList.remove('dark');
                }

                themeToggleBtn.addEventListener('click', function() {
                    document.documentElement.classList.toggle('dark');
                    localStorage.setItem('color-theme', document.documentElement.classList.contains('dark') ? 'dark' : 'light');
                });
            }

            // Mobile menu toggle
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const navContent = document.getElementById('nav-content');

            console.log('Mobile menu button:', mobileMenuButton);
            console.log('Nav content:', navContent);

            if (mobileMenuButton && navContent) {
                mobileMenuButton.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();

                    console.log('Mobile menu button clicked!');

                    const isClosed = navContent.classList.contains('mobile-menu-closed');
                    console.log('Is menu closed?', isClosed);

                    if (isClosed) {
                        // Show menu
                        navContent.classList.remove('hidden', 'mobile-menu-closed');
                        navContent.classList.add('mobile-menu-open');
                        console.log('Showing menu');
                    } else {
                        // Hide menu
                        navContent.classList.remove('mobile-menu-open');
                        navContent.classList.add('mobile-menu-closed');
                        console.log('Hiding menu');
                    }

                    // Toggle hamburger to X icon
                    const icon = mobileMenuButton.querySelector('i');
                    if (icon) {
                        if (icon.classList.contains('fa-bars')) {
                            icon.classList.remove('fa-bars');
                            icon.classList.add('fa-times');
                        } else {
                            icon.classList.remove('fa-times');
                            icon.classList.add('fa-bars');
                        }
                    }
                });

                // Close mobile menu when clicking outside
                document.addEventListener('click', function(e) {
                    if (!mobileMenuButton.contains(e.target) && !navContent.contains(e.target)) {
                        navContent.classList.add('hidden');
                        navContent.classList.remove('block');
                        const icon = mobileMenuButton.querySelector('i');
                        if (icon) {
                            icon.classList.remove('fa-times');
                            icon.classList.add('fa-bars');
                        }
                    }
                });

                // Close mobile menu when pressing Escape key
                document.addEventListener('keydown', function(e) {
                    if (e.key === 'Escape' && !navContent.classList.contains('hidden')) {
                        navContent.classList.add('hidden');
                        navContent.classList.remove('block');
                        const icon = mobileMenuButton.querySelector('i');
                        if (icon) {
                            icon.classList.remove('fa-times');
                            icon.classList.add('fa-bars');
                        }
                    }
                });
            }

            // Close mobile menu when clicking a nav link
            const navLinks = document.querySelectorAll('#nav-content a');
            navLinks.forEach(link => {
                link.addEventListener('click', () => {
                    if (navContent) {
                        navContent.classList.add('hidden');
                        navContent.classList.remove('block');
                    }
                    if (mobileMenuButton) {
                        const icon = mobileMenuButton.querySelector('i');
                        if (icon) {
                            icon.classList.remove('fa-times');
                            icon.classList.add('fa-bars');
                        }
                    }
                });
            });

            // Scroll effect for header
            const header = document.querySelector('header');
            window.addEventListener('scroll', function() {
                if (window.scrollY > 20) {
                    header.classList.add('shadow-lg', 'dark:dark-shadow-lg');
                    header.classList.remove('shadow-md', 'dark:dark-shadow-md');
                } else {
                    header.classList.add('shadow-md', 'dark:dark-shadow-md');
                    header.classList.remove('shadow-lg', 'dark:dark-shadow-lg');
                }
            });

            // Alert close buttons
            const alertCloseButtons = document.querySelectorAll('.alert-close');
            if (alertCloseButtons.length > 0) {
                alertCloseButtons.forEach(button => {
                    button.addEventListener('click', function() {
                        const alert = this.closest('[role="alert"]');
                        if (alert) {
                            alert.classList.add('opacity-0');
                            setTimeout(() => {
                                alert.remove();
                            }, 300);
                        }
                    });
                });
            }

            // Newsletter form handling
            const newsletterForm = document.getElementById('newsletter-form');
            if (newsletterForm) {
                newsletterForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    const emailInput = this.querySelector('input[type="email"]');
                    if (emailInput && emailInput.value) {
                        const formParent = this.parentElement;
                        const successMessage = document.createElement('div');
                        this.classList.add('hidden');
                        successMessage.className = 'bg-green-100 dark:bg-green-800 text-green-800 dark:text-green-200 rounded-lg p-4 flex items-center justify-center animate-fade-in transition-all duration-300 text-sm sm:text-base';
                        successMessage.innerHTML = '<i class="fas fa-check-circle mr-2"></i> Thank you for subscribing! Check your inbox soon.';
                        formParent.appendChild(successMessage);
                        setTimeout(() => {
                            successMessage.classList.add('opacity-0');
                            setTimeout(() => {
                                successMessage.remove();
                                this.classList.remove('hidden');
                                emailInput.value = '';
                            }, 300);
                        }, 5000);
                    }
                });
            }
        });
    </script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Language toggle functionality
            const languageToggle = document.getElementById('language-toggle');
            const languageDropdown = document.getElementById('language-dropdown');
            const chevronIcon = document.getElementById('chevron-icon');

            if (languageToggle && languageDropdown) {
                languageToggle.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();

                    const isHidden = languageDropdown.classList.contains('hidden');

                    if (isHidden) {
                        // Show dropdown
                        languageDropdown.classList.remove('hidden');
                        setTimeout(() => {
                            languageDropdown.classList.remove('opacity-0', 'scale-95');
                            languageDropdown.classList.add('opacity-100', 'scale-100');
                        }, 10);
                        chevronIcon.style.transform = 'rotate(180deg)';
                    } else {
                        // Hide dropdown
                        languageDropdown.classList.remove('opacity-100', 'scale-100');
                        languageDropdown.classList.add('opacity-0', 'scale-95');
                        setTimeout(() => {
                            languageDropdown.classList.add('hidden');
                        }, 200);
                        chevronIcon.style.transform = 'rotate(0deg)';
                    }
                });

                // Close dropdown when clicking outside
                document.addEventListener('click', function(e) {
                    if (!languageToggle.contains(e.target) && !languageDropdown.contains(e.target)) {
                        languageDropdown.classList.remove('opacity-100', 'scale-100');
                        languageDropdown.classList.add('opacity-0', 'scale-95');
                        setTimeout(() => {
                            languageDropdown.classList.add('hidden');
                        }, 200);
                        chevronIcon.style.transform = 'rotate(0deg)';
                    }
                });

                // Close dropdown when pressing Escape key
                document.addEventListener('keydown', function(e) {
                    if (e.key === 'Escape' && !languageDropdown.classList.contains('hidden')) {
                        languageDropdown.classList.remove('opacity-100', 'scale-100');
                        languageDropdown.classList.add('opacity-0', 'scale-95');
                        setTimeout(() => {
                            languageDropdown.classList.add('hidden');
                        }, 200);
                        chevronIcon.style.transform = 'rotate(0deg)';
                    }
                });
            }

            // Language switching function
            window.switchLanguage = function(language) {
                const currentPath = window.location.pathname;
                let targetUrl;

                if (language === 'lo') {
                    // For Lao (default language, no prefix)
                    if (currentPath.startsWith('/en/')) {
                        targetUrl = currentPath.substring(3) || '/';
                    } else {
                        targetUrl = currentPath;
                    }
                } else if (language === 'en') {
                    // For English (/en prefix)
                    if (currentPath.startsWith('/en/')) {
                        targetUrl = currentPath;
                    } else {
                        targetUrl = '/en' + (currentPath === '/' ? '/' : currentPath);
                    }
                }

                // Use GET request approach to avoid CSRF issues
                const form = document.createElement('form');
                form.method = 'POST';
                form.action = '{% url "set_language" %}';

                // Add CSRF token
                const csrfInput = document.createElement('input');
                csrfInput.type = 'hidden';
                csrfInput.name = 'csrfmiddlewaretoken';
                csrfInput.value = getCsrfToken();
                form.appendChild(csrfInput);

                // Add language
                const langInput = document.createElement('input');
                langInput.type = 'hidden';
                langInput.name = 'language';
                langInput.value = language;
                form.appendChild(langInput);

                // Add next URL
                const nextInput = document.createElement('input');
                nextInput.type = 'hidden';
                nextInput.name = 'next';
                nextInput.value = targetUrl;
                form.appendChild(nextInput);

                document.body.appendChild(form);
                form.submit();
            };

            // Function to get CSRF token from various sources
            function getCsrfToken() {
                // First try the hidden CSRF form
                const csrfForm = document.getElementById('csrf-form');
                if (csrfForm) {
                    const csrfInput = csrfForm.querySelector('[name="csrfmiddlewaretoken"]');
                    if (csrfInput) {
                        return csrfInput.value;
                    }
                }

                // Try to get from cookie
                const cookieValue = document.cookie.split(';').find(c => c.trim().startsWith('csrftoken='));
                if (cookieValue) {
                    return cookieValue.split('=')[1];
                }

                // Fallback to meta tag
                const metaTag = document.querySelector('meta[name="csrf-token"]');
                if (metaTag) {
                    return metaTag.getAttribute('content');
                }

                // Last fallback - try to find any existing CSRF token in the page
                const existingToken = document.querySelector('[name="csrfmiddlewaretoken"]');
                if (existingToken) {
                    return existingToken.value;
                }

                console.error('No CSRF token found');
                return '';
            }
        });
        </script>
    {% block extra_js %}{% endblock %}
</body>
</html>